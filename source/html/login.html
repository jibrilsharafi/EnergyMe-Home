<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" type="text/css" href="/css/button.css">
    <link rel="stylesheet" type="text/css" href="/css/styles.css">
    <link rel="stylesheet" type="text/css" href="/css/section.css">
    <link rel="stylesheet" type="text/css" href="/css/typography.css">

    <link rel="icon" type="image/svg+xml" href="/favicon.svg">

    <title>EnergyMe - Login</title>

    <style>
        .login-container {
            max-width: 400px;
            margin: 100px auto;
            padding: 30px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background-color: white;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
        }

        .login-header {
            text-align: center;
            font-size: 48px;
            margin-bottom: 10px;
        }

        .login-subheader {
            text-align: center;
            font-size: 18px;
            color: #666;
            margin-bottom: 30px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .form-group input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            box-sizing: border-box;
        }

        .login-button {
            width: 100%;
            padding: 12px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .login-button:hover {
            background-color: #0056b3;
        }

        .login-button:disabled {
            background-color: #6c757d;
            cursor: not-allowed;
        }

        .error-message {
            color: #dc3545;
            text-align: center;
            margin-top: 10px;
            display: none;
        }        .success-message {
            color: #28a745;
            text-align: center;
            margin-top: 10px;
            display: none;
            font-weight: bold;
            padding: 10px;
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            border-radius: 5px;
            animation: successPulse 0.6s ease-in-out;
        }

        @keyframes successPulse {
            0% { transform: scale(0.95); opacity: 0; }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); opacity: 1; }
        }
    </style>
</head>

<body>
    <div class="login-container">
        <div class="login-header">EnergyMe</div>
        <div class="login-subheader">Please sign in to continue</div>

        <form id="loginForm">
            <div class="form-group">
                <label for="username">Username:</label>
                <input type="text" id="username" name="username" value="admin" readonly>
            </div>

            <div class="form-group">
                <label for="password">Password:</label>
                <input type="password" id="password" name="password" required>
            </div>

            <button type="submit" class="login-button" id="loginButton">Sign In</button>

            <div class="error-message" id="errorMessage"></div>
            <div class="success-message" id="successMessage"></div>
        </form>
    </div>    <script>
        // Array of fun login success messages
        const funLoginMessages = [
            "Welcome back, you electricity hoarder! ðŸ”Œ",
            "Oh look who's back to stalk their power bill! ðŸ’¸",
            "Successfully logged in to judge your energy habits! ðŸ“ˆ",
            "Welcome! Time to see how much you spent on leaving lights on! ðŸ’¡",
            "Access granted! Ready to cringe at your usage stats? ðŸ˜¬",
            "You're in! Prepare for some shocking revelations! âš¡",
            "Login successful! Your wallet is already trembling! ðŸ’°",
            "Welcome back, energy detective! Time to solve the mystery of the high bill! ðŸ•µï¸",
            "Successfully connected! Your appliances have been gossiping about you! ðŸ“±",
            "You're in! Ready to play 'Guess Which Device Ate My Money'? ðŸŽ°"
        ];

        function getRandomLoginMessage() {
            return funLoginMessages[Math.floor(Math.random() * funLoginMessages.length)];
        }

        document.getElementById('loginForm').addEventListener('submit', function (e) {
            e.preventDefault();

            const password = document.getElementById('password').value;
            const loginButton = document.getElementById('loginButton');
            const errorMessage = document.getElementById('errorMessage');
            const successMessage = document.getElementById('successMessage');

            // Hide previous messages
            errorMessage.style.display = 'none';
            successMessage.style.display = 'none';

            // Disable button and show loading
            loginButton.disabled = true;
            loginButton.textContent = 'Signing in...';

            fetch('/rest/auth/login', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    password: password
                })
            })
                .then(response => response.json())                .then(data => {
                    if (data.success) {
                        successMessage.textContent = getRandomLoginMessage();
                        successMessage.style.display = 'block';

                        // Store token in localStorage as backup
                        if (data.token) {
                            localStorage.setItem('auth_token', data.token);
                        }

                        // Redirect to main page
                        setTimeout(() => {
                            window.location.href = '/';
                        }, 2000);
                    } else {
                        errorMessage.textContent = data.message || 'Login failed';
                        errorMessage.style.display = 'block';
                    }
                })
                .catch(error => {
                    console.error('Login error:', error);
                    errorMessage.textContent = 'Network error. Please try again.';
                    errorMessage.style.display = 'block';
                })
                .finally(() => {
                    // Re-enable button
                    loginButton.disabled = false;
                    loginButton.textContent = 'Sign In';
                });
        });

        // Check if already authenticated
        window.addEventListener('load', function () {
            fetch('/rest/auth/status')
                .then(response => response.json())
                .then(data => {
                    if (data.authenticated) {
                        window.location.href = '/';
                    }
                })
                .catch(error => {
                    console.log('Auth check failed:', error);
                });
        });
    </script>
</body>

</html>