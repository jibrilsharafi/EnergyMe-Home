<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" type="text/css" href="/css/button.css">
    <link rel="stylesheet" type="text/css" href="/css/styles.css">
    <link rel="stylesheet" type="text/css" href="/css/section.css">
    <link rel="stylesheet" type="text/css" href="/css/typography.css">

    <link rel="icon" type="image/svg+xml" href="/favicon.svg">

    <title>EnergyMe - Login</title>

    <style>
        .login-container {
            max-width: 400px;
            margin: 100px auto;
            padding: 30px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background-color: white;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
        }

        .login-header {
            text-align: center;
            font-size: 48px;
            margin-bottom: 10px;
        }

        .login-subheader {
            text-align: center;
            font-size: 18px;
            color: #666;
            margin-bottom: 30px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .form-group input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            box-sizing: border-box;
        }

        .login-button {
            width: 100%;
            padding: 12px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .login-button:hover {
            background-color: #0056b3;
        }

        .login-button:disabled {
            background-color: #6c757d;
            cursor: not-allowed;
        }

        .error-message {
            color: #dc3545;
            text-align: center;
            margin-top: 10px;
            display: none;
        }

        .success-message {
            color: #28a745;
            text-align: center;
            margin-top: 10px;
            display: none;
            font-weight: bold;
            padding: 10px;
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            border-radius: 5px;
            animation: successPulse 0.6s ease-in-out;
        }

        @keyframes successPulse {
            0% {
                transform: scale(0.95);
                opacity: 0;
            }

            50% {
                transform: scale(1.05);
            }

            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        .info-section {
            margin-top: 20px;
            text-align: center;
        }

        .info-button {
            background: none;
            border: none;
            color: #6c757d;
            cursor: pointer;
            font-size: 14px;
            text-decoration: underline;
            padding: 5px;
            transition: color 0.3s;
        }

        .info-button:hover {
            color: #007bff;
        }

        .info-icon {
            margin-right: 5px;
        }

        .info-content {
            margin-top: 15px;
            animation: slideDown 0.3s ease-out;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .info-box {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            text-align: left;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .info-box h3 {
            margin: 0 0 15px 0;
            color: #495057;
            font-size: 18px;
        }

        .info-box p {
            margin: 0 0 15px 0;
            line-height: 1.5;
            color: #6c757d;
        }

        .recovery-steps {
            margin: 15px 0;
            padding-left: 20px;
        }

        .recovery-steps li {
            margin-bottom: 8px;
            line-height: 1.4;
            color: #495057;
        }

        .recovery-steps strong {
            color: #007bff;
        }

        .recovery-steps code {
            background-color: #e9ecef;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            color: #e83e8c;
        }

        .security-note,
        .warning-note {
            margin-top: 15px;
            padding: 10px;
            border-radius: 5px;
            font-size: 13px;
        }

        .security-note {
            background-color: #d1ecf1;
            border-left: 4px solid #bee5eb;
            color: #0c5460;
        }

        .warning-note {
            background-color: #fff3cd;
            border-left: 4px solid #ffeaa7;
            color: #856404;
        }
    </style>
</head>

<body>
    <div class="login-container">
        <div class="login-header">EnergyMe</div>
        <div class="login-subheader">Please sign in to continue</div>

        <form id="loginForm">
            <div class="form-group">
                <label for="username">Username:</label>
                <input type="text" id="username" name="username" value="admin" readonly>
            </div>

            <div class="form-group">
                <label for="password">Password:</label>
                <input type="password" id="password" name="password" required>
            </div> <button type="submit" class="login-button" id="loginButton">üîê Sign In</button>

            <div class="error-message" id="errorMessage"></div>
            <div class="success-message" id="successMessage"></div>
        </form>

        <div class="info-section">
            <button type="button" class="info-button" id="infoButton">
                <span class="info-icon">‚ÑπÔ∏è</span> Forgot Password?
            </button>
            <div class="info-content" id="infoContent" style="display: none;">
                <div class="info-box">
                    <h3>üîê Password Recovery</h3>
                    <p>If you've forgotten your password, you can reset it using the <strong>physical button</strong> on
                        your device:</p>
                    <ol class="recovery-steps">
                        <li><strong>Locate</strong> the GPIO0 button on your EnergyMe device (labelled "FLASH")</li>
                        <li><strong>Press and hold</strong> the button for <strong>6-10 seconds</strong></li>
                        <li><strong>Watch</strong> for the LED to turn yellow</li>
                        <li><strong>Release</strong> the button</li>
                        <li><strong>Now log in</strong> with the default password: <code>energyme</code></li>
                    </ol>
                    <div class="warning-note">
                        <strong>‚ö†Ô∏è Button held too long?</strong> If you pressed the button for more than 10 seconds,
                        continue holding it for 30 seconds until the LED turns white, then release. Nothing will happen,
                        and you can repeat the process from step 2.
                    </div>
                    <div class="security-note">
                        <strong>üõ°Ô∏è Security:</strong> This reset requires physical access to your device, ensuring only
                        authorized users can reset the password.
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        // Array of fun login success messages
        const funLoginMessages = [
            "Welcome back, you electricity hoarder! üîå",
            "Oh look who's back to stalk their power bill! üí∏",
            "Successfully logged in to judge your energy habits! üìà",
            "Welcome! Time to see how much you spent on leaving lights on! üí°",
            "Access granted! Ready to cringe at your usage stats? üò¨",
            "You're in! Prepare for some shocking revelations! ‚ö°",
            "Login successful! Your wallet is already trembling! üí∞",
            "Welcome back, energy detective! Time to solve the mystery of the high bill! üïµÔ∏è",
            "Successfully connected! Your appliances have been gossiping about you! üì±",
            "You're in! Ready to play 'Guess Which Device Ate My Money'? üé∞"
        ];

        function getRandomLoginMessage() {
            return funLoginMessages[Math.floor(Math.random() * funLoginMessages.length)];
        }

        document.getElementById('loginForm').addEventListener('submit', function (e) {
            e.preventDefault();

            const password = document.getElementById('password').value;
            const loginButton = document.getElementById('loginButton');
            const errorMessage = document.getElementById('errorMessage');
            const successMessage = document.getElementById('successMessage');

            // Hide previous messages
            errorMessage.style.display = 'none';
            successMessage.style.display = 'none';

            // Disable button and show loading
            loginButton.disabled = true;
            loginButton.textContent = 'Signing in...';

            fetch('/rest/auth/login', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    password: password
                })
            })
                .then(response => response.json()).then(data => {
                    if (data.success) {
                        successMessage.textContent = getRandomLoginMessage();
                        successMessage.style.display = 'block';

                        // Store token in localStorage as backup
                        if (data.token) {
                            localStorage.setItem('auth_token', data.token);
                        }

                        // Redirect to main page
                        setTimeout(() => {
                            window.location.href = '/';
                        }, 2000);
                    } else {
                        errorMessage.textContent = data.message || 'Login failed';
                        errorMessage.style.display = 'block';
                    }
                })
                .catch(error => {
                    console.error('Login error:', error);
                    errorMessage.textContent = 'Network error. Please try again.';
                    errorMessage.style.display = 'block';
                })
                .finally(() => {
                    // Re-enable button
                    loginButton.disabled = false;
                    loginButton.textContent = 'Sign In';
                });
        });        // Check if already authenticated
        window.addEventListener('load', function () {
            fetch('/rest/auth/status')
                .then(response => response.json())
                .then(data => {
                    if (data.authenticated) {
                        window.location.href = '/';
                    }
                })
                .catch(error => {
                    console.log('Auth check failed:', error);
                });
        });

        // Handle info button toggle
        document.getElementById('infoButton').addEventListener('click', function () {
            const infoContent = document.getElementById('infoContent');
            const isVisible = infoContent.style.display !== 'none';

            if (isVisible) {
                infoContent.style.display = 'none';
                this.innerHTML = '<span class="info-icon">‚ÑπÔ∏è</span> Forgot Password?';
            } else {
                infoContent.style.display = 'block';
                this.innerHTML = '<span class="info-icon">‚ùå</span> Close Info';
            }
        });
    </script>
</body>

</html>